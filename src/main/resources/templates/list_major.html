<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="Mosaddek">
  <meta name="keyword"
        content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
  <link rel="shortcut icon" href="img/favicon.html">

  <title>专业列表</title>

  <!-- Bootstrap core CSS -->
  <link th:href="@{~/css/bootstrap.min.css}" rel="stylesheet">
  <link th:href="@{~/css/bootstrap-reset.css}" rel="stylesheet">
  <!--external css-->
  <link th:href="@{~/assets/font-awesome/css/font-awesome.css}" rel="stylesheet"/>
  <!-- Custom styles for this template -->
  <link th:href="@{~/css/style.css}" rel="stylesheet">
  <link th:href="@{~/css/style-responsive.css}" rel="stylesheet"/>

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
  <!--[if lt IE 9]>
  <script th:src="@{~/js/html5shiv.js}"></script>
  <script th:src="@{~/js/respond.min.js}"></script>
  <![endif]-->
</head>

<body>

<section id="container" class="">
  <!--header start-->
  <header class="header white-bg">
    <div class="sidebar-toggle-box">
      <div data-original-title="Toggle Navigation" data-placement="right"
           class="icon-reorder tooltips"></div>
    </div>
    <!--logo start-->
    <a href="#" class="logo">教师评教系统</span></a>
    <!--logo end-->

  </header>
  <!--header end-->
  <!--sidebar start-->
  <aside>
    <div id="sidebar" class="nav-collapse ">
      <!-- sidebar menu start-->
      <ul class="sidebar-menu">
        <li class="">
          <a class="" th:href="@{~/home}">
            <i class="icon-user"></i>
            <span>个人中心</span>
          </a>
        </li>
        <li class="sub-menu">
          <a href="javascript:;" class="">
            <i class="icon-cogs"></i>
            <span>个人设置</span>
            <span class="arrow"></span>
          </a>
          <ul class="sub">
            <li><a class="" th:href="@{~/profile-edit}">编辑个人资料</a></li>
            <li><a class="" th:href="@{~/security-edit}">安全设置</a></li>
          </ul>
        </li>
        <li>
          <a class="" th:href="@{~/list_teacher}">
            <i class="icon-check"></i>
            <span>教师信息管理</span>
          </a>
        </li>
        <li class="active">
          <a  th:href="@{~/list_major}">
            <i class="icon-check"></i>
            <span>专业信息管理</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/list_class}">
            <i class="icon-check"></i>
            <span>班级信息管理</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/list_student}">
            <i class="icon-check"></i>
            <span>学生信息管理</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/list_course}">
            <i class="icon-check"></i>
            <span>课程管理</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/list_xuanke}">
            <i class="icon-check"></i>
            <span>选课管理</span>
          </a>
        </li>
        <li class="sub-menu">
          <a class="" href="javascript:void(0)">
            <i class="icon-check"></i>
            <span>题库管理</span>
          </a>
          <ul class="sub">
            <li class=""><a class="" th:href="@{~/list_question}">问题管理</a></li>
            <li><a class="" th:href="@{~/list_paper}">问卷管理</a></li>
          </ul>
        </li>
        <li>
          <a class="" th:href="@{~/get_result}">
            <i class="icon-check"></i>
            <span>评教结果查看</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/result_charts}">
            <i class="icon-check"></i>
            <span>统计分析</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/login}">
            <i class="icon-signout"></i>
            <span>退出系统</span>
          </a>
        </li>
      </ul>
      <!-- sidebar menu end-->
    </div>
  </aside>
  <!--sidebar end-->
  <!--main content start-->
  <section id="main-content">
    <section class="wrapper">

      <!--table start-->
      <div class="row">
        <div class="col-lg-12">
          <section class="panel">
            <header class="panel-heading">
              专业列表
            </header>
            <table class="table table-striped border-top" id="sample_2">
              <thead>
              <tr>
                <th style="width:8px;"><input type="checkbox" class="group-checkable"
                                              data-set="#sample_2 .checkboxes"/></th>
                <th>专业名称</th>
                <th class="hidden-phone text-center">专业人数</th>
                <th class="hidden-phone text-center">操作</th>
              </tr>
              </thead>
              <tbody>
              <tr class="odd gradeX" th:each="major:${majors}">
                <td><input type="checkbox" class="checkboxes" th:value="${major.oid}"/></td>
                <td class="hidden-phone " th:text="${major.majorName}">课堂表现</td>
                <td class="hidden-phone text-center" id="count" th:text="${major.count}">优秀</td>

                <td class="hidden-phone text-center">
                  <!--修改-->
                  <a class="btn btn-primary btn-xs" id="edit" th:data-id="${major.oid}" th:onclick="modalRend(this.getAttribute('data-id'))"><i class="icon-pencil"></i></a>
                  <a class="btn btn-danger btn-xs" th:data-id="${major.oid}" th:onclick="deleteMajor(this.parentNode.parentNode,this.getAttribute('data-id'))"><i
                      class="icon-trash "></i></a>
                </td>
              </tr>
              </tbody>
            </table>
          </section>
        </div>
      </div>
      <!--table end-->

      <!-- page end-->
    </section>
  </section>
  <!--main content end-->
</section>
<!--model start-->
<div class="modal fade" id="teacher—add" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">新增专业</h4>
      </div>
      <div class="modal-body">
        <!--page start-->
        <div class="row">
          <div class="col-lg-12">
            <section class="panel">

              <div class="panel-body">
                <div class="form">
                  <form class="cmxform form-horizontal tasi-form" id="signupForm" method="get"
                        action="#">
                    <div class="form-group ">
                      <label for="teacherName" class="control-label col-lg-2">专业名称</label>
                      <div class="col-lg-10">
                        <input class=" form-control" id="teacherName" name="question" type="text" required/>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" th:onclick="addMajor()">保存</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--model end-->

<!--model start-->
<div class="modal fade" tabindex="-1" role="dialog" id="modal2">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">编辑专业信息</h4>
      </div>
      <div class="modal-body">
        <!--page start-->
        <div class="row">
          <div class="col-lg-12">
            <section class="panel">

              <div class="panel-body">
                <div class="form">
                  <form class="cmxform form-horizontal tasi-form" id="signupForm" method="get"
                        action="#">
                    <div class="form-group ">
                      <label for="majorName" class="control-label col-lg-2">专业名称</label>
                      <div class="col-lg-10">
                        <input class=" form-control" id="majorName" type="text" required/>
                      </div>
                    </div>

                  </form>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary">保存</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--model end-->
<!-- js placed at the end of the document so the pages load faster -->
<script th:src="@{~/js/jquery.js}"></script>
<script th:src="@{~/js/bootstrap.min.js}"></script>
<script th:src="@{~/js/jquery.scrollTo.min.js}"></script>
<script th:src="@{~/js/jquery.nicescroll.js}" type="text/javascript"></script>
<script type="text/javascript" th:src="@{~/js/jquery.validate.min.js}"></script>

<script type="text/javascript" th:src="@{~/assets/data-tables/jquery.dataTables.js}"></script>
<script type="text/javascript" th:src="@{~/assets/data-tables/DT_bootstrap.js}"></script>


<!--common script for all pages-->
<script th:src="@{~/js/common-scripts.js}"></script>

<!--script for this page-->
<script th:src="@{~/js/form-validation-script.js}"></script>
<script th:src="@{~/js/dynamic-table.js}"></script>
<script>
  $(document).ready(function () {
    $('#addPaper').click(function () {
      $('#teacher—add').modal("show");
    });
  });

  function preview() {
    $("#paper—preview").modal("show");
  }
  //添加专业
  function addMajor() {
    if ($('#teacherName').val()==''){
      alert("请添加专业名称")
      return;
    }
    $.ajax({
      url: "addMajor",
      type: "post",
      dataType: "json",
      contentType: "application/json",
      data: JSON.stringify(
          {
            majorName:$('#teacherName').val()//模板复制过来的，没改id
          }
      ),
      success: function (data) {
        if (data.success) {
          alert("添加成功");
          window.location.replace("list_major");
        } else {
          alert("添加失败:"+data.errMsg);
        }
      }
    });
  }
  //渲染被点击的模态框
  function modalRend(oid) {
    $('#modal2 button.btn-primary').attr("onclick","updateMajor('"+oid+"')");
    $.ajax({
      url:"getMajor?oid="+oid,
      type:"get",
      dataType:"json",
      success:function (data) {
        $('#majorName').val(data.majorName);
      }
    });
    $('#modal2').modal('show');
  }
  //更新班级信息
  function updateMajor(oid) {
    $.ajax({
      url:"updateMajor",
      type:"post",
      dataType:"json",
      contentType:"application/json",
      data:JSON.stringify({
        oid:oid,
        majorName:$("#majorName").val()
      }),
      success:function (data) {
        if (data.success){
          alert("更新成功");
          window.location.replace("list_major");
        } else{
          alert("更新失败");
        }
      },
      error:function () {
        alert("ajax请求出错")
      }
    });
  }
  //预删除
  function deleteMajor(a,oid) {
    var target_tr = $(a);//转成jQuery对象

    var count  =target_tr.children("#count").text();
    // console.log("学生数是"+count)
    if (count==0){
      realDel(oid);
    } else {
      alert("班级内还有学生，不能删除")
    }
  }
  //真删除
  function realDel(oid) {
    $.ajax({
      url:"deleteMajor?",
      type:"post",
      dataType:"json",
      contentType:"application/json",
      data:JSON.stringify({
        oid:oid
      }),
      success:function (data) {
        if (data.success){
          alert("删除成功");
        } else {
          alert("删除失败");
        }
        location.replace("list_major");
      },
      error:function () {
        alert("ajax请求出错")
      }
    });
  }
</script>

</body>
</html>
