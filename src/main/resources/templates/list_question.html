<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="Mosaddek">
  <meta name="keyword"
        content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
  <link rel="shortcut icon" href="img/favicon.html">

  <title>题库</title>

  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-reset.css" rel="stylesheet">
  <!--external css-->
  <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet"/>
  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet"/>

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
</head>

<body>

<section id="container" class="">
  <!--header start-->
  <header class="header white-bg">
    <div class="sidebar-toggle-box">
      <div data-original-title="Toggle Navigation" data-placement="right"
           class="icon-reorder tooltips"></div>
    </div>
    <!--logo start-->
    <a href="#" class="logo">教师评教系统</span></a>
    <!--logo end-->

  </header>
  <!--header end-->
  <!--sidebar start-->
  <aside>
    <div id="sidebar" class="nav-collapse ">
      <!-- sidebar menu start-->
      <ul class="sidebar-menu">
        <li>
          <a class="" th:href="@{~/home}">
            <i class="icon-user"></i>
            <span>个人中心</span>
          </a>
        </li>
        <li class="sub-menu">
          <a href="javascript:;" class="">
            <i class="icon-cogs"></i>
            <span>个人设置</span>
            <span class="arrow"></span>
          </a>
          <ul class="sub">
            <li><a class="" th:href="@{~/profile-edit}">编辑个人资料</a></li>
            <li><a class="" th:href="@{~/security-edit}">安全设置</a></li>
          </ul>
        </li>
        <li>
          <a class="" th:href="@{~/list_teacher}">
            <i class="icon-check"></i>
            <span>教师信息管理</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/list_major}">
            <i class="icon-check"></i>
            <span>专业信息管理</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/list_class}">
            <i class="icon-check"></i>
            <span>班级信息管理</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/list_student}">
            <i class="icon-check"></i>
            <span>学生信息管理</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/list_course}">
            <i class="icon-check"></i>
            <span>课程管理</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/list_xuanke}">
            <i class="icon-check"></i>
            <span>选课管理</span>
          </a>
        </li>
        <li class="sub-menu active">
          <a class="" href="javascript:void(0)">
            <i class="icon-check"></i>
            <span>题库管理</span>
          </a>
          <ul class="sub">
            <li class="active"><a class="" th:href="@{~/list_question}">问题管理</a></li>
            <li><a class="" th:href="@{~/list_paper}">问卷管理</a></li>
          </ul>
        </li>
        <li>
          <a class="" th:href="@{~/get_result}">
            <i class="icon-check"></i>
            <span>评教结果查看</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/result_charts}">
            <i class="icon-check"></i>
            <span>统计分析</span>
          </a>
        </li>
        <li>
          <a class="" th:href="@{~/login}">
            <i class="icon-signout"></i>
            <span>退出系统</span>
          </a>
        </li>
      </ul>
      <!-- sidebar menu end-->
    </div>
  </aside>
  <!--sidebar end-->
  <!--main content start-->
  <section id="main-content">
    <section class="wrapper">
      <!-- page start-->
      <!--table start-->
      <div class="row">
        <div class="col-lg-12">
          <section class="panel">
            <header class="panel-heading">
              题库
            </header>
            <table class="table table-striped border-top" id="sample_1">
              <thead>
              <tr>
                <th style="width:8px;"><input type="checkbox" class="group-checkable"
                                              data-set="#sample_1 .checkboxes"/></th>
                <th>题目</th>
                <th class="hidden-phone text-center">选项A</th>
                <th class="hidden-phone text-center">分值</th>
                <th class="hidden-phone text-center">选项B</th>
                <th class="hidden-phone text-center">分值</th>
                <th class="hidden-phone text-center">选项C</th>
                <th class="hidden-phone text-center">分值</th>
                <th class="hidden-phone text-center">选项D</th>
                <th class="hidden-phone text-center">分值</th>
                <th class="hidden-phone text-center">操作</th>
              </tr>
              </thead>
              <tbody>
              <tr class="odd gradeX" th:each="question:${questions}">
                <td><input type="checkbox" class="checkboxes" th:value="${question.oid}"/></td>
                <td class="hidden-phone text-center" th:text="${question.question}">课堂表现</td>
                <td class="hidden-phone text-center" th:text="${question.answerA}">优秀</td>
                <td class="hidden-phone text-center" th:text="${question.scoreA}">4</td>
                <td class="hidden-phone text-center" th:text="${question.answerB}">良好</td>
                <td class="hidden-phone text-center" th:text="${question.scoreB}">3</td>
                <td class="hidden-phone text-center" th:text="${question.answerC}">一般</td>
                <td class="hidden-phone text-center" th:text="${question.scoreC}">2</td>
                <td class="hidden-phone text-center" th:text="${question.answerD}">差</td>
                <td class="hidden-phone text-center" th:text="${question.scoreD}">0</td>
                <td class="hidden-phone text-center">
                  <a class="btn btn-primary btn-xs"
                     th:data-id="${question.oid}" th:onclick="renderModal(this.getAttribute('data-id'))">
                    <i class="icon-pencil"></i>
                  </a>
                  <a class="btn btn-danger btn-xs" th:href="@{/delete(oid=${question.oid})}"><i
                      class="icon-trash "></i></a>
                </td>
              </tr>

              </tbody>
            </table>
          </section>
        </div>
      </div>
      <!--table end-->

      <!-- page end-->
    </section>
  </section>
  <!--main content end-->
</section>
<!--model1 start-->
<div class="modal fade" tabindex="-1" role="dialog" id="modal1">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
        <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body">
        <!--page start-->
        <div class="row">
          <div class="col-lg-12">
            <section class="panel">

              <div class="panel-body">
                <div class="form">
                  <form class="cmxform form-horizontal tasi-form" id="signupForm" method="get"
                        action="#">
                    <div class="form-group ">
                      <label for="question" class="control-label col-lg-2">问题内容</label>
                      <div class="col-lg-10">
                        <input class=" form-control" id="question" name="question" type="text"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="answerA" class="control-label col-lg-2">选项A</label>
                      <div class="col-lg-6">
                        <input class=" form-control" id="answerA" name="answerA" type="text"/>
                      </div>
                      <label for="scoreA" class="control-label col-lg-2">分值</label>
                      <div class="col-lg-2">
                        <input class=" form-control" id="scoreA" name="scoreA" type="text"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="answerA" class="control-label col-lg-2">选项B</label>
                      <div class="col-lg-6">
                        <input class=" form-control" id="answerB" name="answerB" type="text"/>
                      </div>
                      <label for="scoreA" class="control-label col-lg-2">分值</label>
                      <div class="col-lg-2">
                        <input class=" form-control" id="scoreB" name="scoreB" type="text"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="answerA" class="control-label col-lg-2">选项C</label>
                      <div class="col-xs-6">
                        <input class=" form-control" id="answerC" name="answerC" type="text"/>
                      </div>
                      <label for="scoreA" class="control-label col-lg-2">分值</label>
                      <div class="col-xs-2">
                        <input class=" form-control" id="scoreC" name="scoreC" type="text"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="answerA" class="control-label col-lg-2">选项D</label>
                      <div class="col-lg-6">
                        <input class=" form-control" id="answerD" name="answerD" type="text"/>
                      </div>
                      <label for="scoreA" class="control-label col-lg-2">分值</label>
                      <div class="col-xs-2">
                        <input class=" form-control" id="scoreD" name="scoreD" type="text"/>
                      </div>
                    </div>

                  </form>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary">保存</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--model end-->
<!--model2 start-->
<div class="modal fade" tabindex="-1" role="dialog" id="modal2">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">添加到问卷</h4>
      </div>
      <div class="modal-body">
        <!--page start-->
        <div class="row">
          <div class="col-lg-12">
            <section class="panel">

              <div class="panel-body">
                <div class="form">
                  <form class="cmxform form-horizontal tasi-form" id="signupForm" method="get"
                        action="#">
                    <div class="form-group ">
                      <label for="question" class="control-label col-lg-2">添加到</label>
                      <div class="col-lg-10">
                        <select name="selectPaper" id="paperOption" class="form-control">
                          <option value="">请选择问卷</option>
                          <option th:each="paper:${papers}" th:value="${paper.oid}"
                                  th:text="${paper.paperTitle}"></option>
                        </select>
                      </div>
                    </div>

                  </form>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary">保存</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--model end-->
<!-- js placed at the end of the document so the pages load faster -->
<script src="js/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.scrollTo.min.js"></script>
<script src="js/jquery.nicescroll.js" type="text/javascript"></script>
<script type="text/javascript" src="js/jquery.validate.min.js"></script>

<script type="text/javascript" src="assets/data-tables/jquery.dataTables.js"></script>
<script type="text/javascript" src="assets/data-tables/DT_bootstrap.js"></script>

<!--common script for all pages-->
<script src="js/common-scripts.js"></script>

<!--script for this page-->
<script src="js/form-validation-script.js"></script>
<script src="js/dynamic-table.js"></script>

<script>
  function preAdd() {
    var question = $("#question").val();
    var answerA = $("#answerA").val();
    var answerB = $("#answerB").val();
    var answerC = $("#answerC").val();
    var answerD = $("#answerD").val();
    var scoreA = $("#scoreA").val();
    var scoreB = $("#scoreB").val();
    var scoreC = $("#scoreC").val();
    var scoreD = $("#scoreD").val();
    question&&answerA&&answerB&&answerC&&answerD&&scoreA&&scoreB&&scoreC&&scoreD?addQuestion():alert("请将题目补充完整");
  }
  function addQuestion() {
    $.ajax({
      url: "addQuestion",
      type: "post",
      dataType: "json",
      contentType: "application/json",
      data: JSON.stringify({
        question: $("#question").val(),
        answerA: $("#answerA").val(),
        answerB: $("#answerB").val(),
        answerC: $("#answerC").val(),
        answerD: $("#answerD").val(),
        scoreA: $("#scoreA").val(),
        scoreB: $("#scoreB").val(),
        scoreC: $("#scoreC").val(),
        scoreD: $("#scoreD").val()
      }),
      success: function (data) {
        if (data.success) {
          window.location.replace("list_question");
        } else {
          alert("添加失败");
        }
      }
    });
  }

  function updateQuestion(oid) {
    var data = {};
    var question = $("#question").val();
    var answerA = $("#answerA").val();
    var answerB = $("#answerB").val();
    var answerC = $("#answerC").val();
    var answerD = $("#answerD").val();
    var scoreA = $("#scoreA").val();
    var scoreB = $("#scoreB").val();
    var scoreC = $("#scoreC").val();
    var scoreD = $("#scoreD").val();
    data.oid = oid;
    data.question = question;
    data.answerA = answerA;
    data.answerB = answerB;
    data.answerC = answerC;
    data.answerD = answerD;
    data.scoreA = scoreA;
    data.scoreB = scoreB;
    data.scoreC = scoreC;
    data.scoreD = scoreD;
    $.ajax({
      url: "updateQuestion",
      type: "post",
      dataType: "json",
      contentType: "application/json",
      data: JSON.stringify(data),
      success: function (data) {
        if (data.success) {
          window.location.replace("list_question");
        } else {
          alert("更新失败");
        }
      },
      error: function () {
        alert("数据请求失败");
      }
    });
  }

  function renderModal(oid) {
    $('.modal-footer button.btn-primary').attr("id", "update");
    $('.modal-footer button.btn-primary').attr("onclick", "updateQuestion('" + oid + "')");
    $.ajax({
      url: "getAQuestion?oid=" + oid,
      type: "get",
      dataType: "json",
      success: function (data) {
        $("#question").val(data.question);
        $("#answerA").val(data.answerA);
        $("#answerB").val(data.answerB);
        $("#answerC").val(data.answerC);
        $("#answerD").val(data.answerD);
        $("#scoreA").val(data.scoreA);
        $("#scoreB").val(data.scoreB);
        $("#scoreC").val(data.scoreC);
        $("#scoreD").val(data.scoreD);
      },
      error: function () {
        alert("数据查询出错");
      }
    });
    $("#modal1 h4").text("编辑问题");
    $("#modal1").modal("show");

  }

  $(document).ready(function () {
    $("#addQ").click(function () { //点击按钮将模态框提交按钮id 改成insert
      $('.modal-footer button.btn-primary').attr("id", "insert").attr("onclick", "preAdd()");
      $("#modal1 h4").text("新增问题");
      $("#modal1").modal("show");
    });

    $("#addToPaper").click(function () {
      $("#modal2").modal("show");
    });

    $("#modal2 .btn-primary").click(function () {
      var chk_value = [];
      $("input:checked").each(function (i) {
        chk_value.push($(this).val());
      });

      console.log(chk_value);
      $.ajax({
        url: "questionsToPaper",
        type: "post",
        data: JSON.stringify({
          oid: $("#paperOption option:selected").val(),
          questions: chk_value
        }),
        contentType: "application/json",
        dataType: "json",
        success: function (data) {
          if (data.success) {
            alert("插入成功");
          } else {
            alert("插入失败");
          }
          $("#modal2").modal("hide");
        },
        error: function () {
          alert("请求失败");
        }
      });
    });

  });

</script>
</body>
</html>
